# =============================================================
# K-CHOPORE Configuration File
# Pipeline for ONT Direct RNA Sequencing Analysis
# =============================================================
# Experiment: anac017-1 mutant vs WT, Control vs Antimycin A (AA)
# 2x2 factorial design (unbalanced: 3+3+3+1 = 10 samples)
# Organism: Arabidopsis thaliana (TAIR10 + AtRTDv2)
# Sequencing: ONT MinION, R9.4.1 flowcell, Direct RNA
# =============================================================

# -------------------------------------------------------------
# SAMPLE SHEET
# Each sample has: genotype, treatment, data_type, and source dirs
# Sample IDs use underscores only (FLAIR requires hyphens in manifest,
# the pipeline converts automatically)
# -------------------------------------------------------------
samples:
  # --- Wild Type, Control (3 replicates) ---
  WT_C_R1:
    genotype: "WT"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["WT_C_R1"]
    run_subdirs: ["no_sample/20220224_1639_MC-112869_FAR90122_f656439d"]
  WT_C_R2:
    genotype: "WT"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["WT_C_R2"]
    run_subdirs: ["no_sample/20220323_1648_MC-112869_FAR91957_0263d5a0"]
  WT_C_R3:
    genotype: "WT"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["WT_C_R3"]
    run_subdirs: ["no_sample/20220301_1656_MC-112869_FAR90189_a35665b9"]

  # --- Wild Type, Antimycin A (3 replicates) ---
  WT_AA_R1:
    genotype: "WT"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["WT_AA_R1"]
    run_subdirs: ["20220221_1734_MC-112869_FAR92050_00e32dc0"]
  WT_AA_R2:
    genotype: "WT"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["WT_AA_R2"]
    run_subdirs: ["no_sample/20220316_1902_MC-112869_FAR91120_624c5f7d"]
  WT_AA_R3:
    genotype: "WT"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["WT_AA_R3", "WT_AA_R3_2"]
    run_subdirs:
      - "no_sample/20220315_1614_MC-112869_FAR90098_c891954b"
      - "no_sample/20220316_1636_MC-112869_FAR90098_6e408c50"

  # --- anac017-1 mutant, Control (3 replicates) ---
  anac017_1_C_R1:
    genotype: "anac017_1"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["anac017-1_C_R1"]
    run_subdirs: ["no_sample/20220330_1936_MC-112869_FAR92015_6ac8671e"]
  anac017_1_C_R2:
    genotype: "anac017_1"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["anac017-1_C_R2"]
    run_subdirs: ["no_sample/20220404_1440_MC-112869_FAR91811_a135af49"]
  anac017_1_C_R3:
    genotype: "anac017_1"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["anac017-1_C_R3"]
    run_subdirs: ["no_sample/20220405_1610_MC-112869_FAR91811_d5fba51e"]

  # --- anac017-1 mutant, Antimycin A (1 replicate) ---
  # Only R1 has pre-basecalled FASTQ data
  # R2 and R3 had FAST5-only data requiring GPU basecalling (excluded)
  anac017_1_AA_R1:
    genotype: "anac017_1"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["anac017-1_AA_R1"]
    run_subdirs: ["no_sample/20220328_1730_MC-112869_FAR90074_970aa1f5"]

# -------------------------------------------------------------
# INPUT FILES AND DIRECTORIES
# -------------------------------------------------------------
input_files:
  raw_data_dir: "data/raw"
  reference_genome: "data/reference/genome/TAIR10_chr_all.fas.fasta"
  reference_genome_mmi: "data/reference/genome/TAIR10_chr_all.fas.fasta.mmi"
  gtf_file: "data/reference/annotations/AtRTDv2_QUASI_19April2016.gtf"
  transcriptome_fasta: "data/reference/transcriptome/transcriptome.fa"

# -------------------------------------------------------------
# OUTPUT SETTINGS
# -------------------------------------------------------------
output:
  path: "results"
  logs: "logs"

# -------------------------------------------------------------
# TOOL CONFIGURATIONS
# -------------------------------------------------------------
tools:
  # Basecalling (not used â€” all 10 samples have pre-basecalled FASTQs)
  basecaller: "guppy"
  guppy_config_file: "/opt/ont-guppy-cpu/data/rna_r9.4.1_70bps_hac.cfg"

  # Alignment - minimap2 (splice-aware for direct RNA)
  minimap2_preset: "splice"
  minimap2_kmer_size: 14
  minimap2_extra_flags: "--secondary=no --MD"

  # Read filtering - NanoFilt
  nanofilt_min_quality: 7
  nanofilt_min_length: 200
  nanofilt_max_length: 0

  # Quality control
  nanoplot_format: "png"
  pycoqc_min_pass_qual: 7

  # Isoform analysis - FLAIR
  flair_support: 3
  flair_stringent: true

  # RNA modification detection - ELIGOS2
  # Note: ELIGOS2 has a known CMH test failure (rpy2/R issue in Docker).
  # The pipeline creates placeholder outputs when ELIGOS2 fails.
  eligos2_pval: 0.05
  eligos2_oddR: 2.5
  eligos2_esb: 0.1

  # RNA modification detection - m6Anet
  m6anet_num_iterations: 1000
  m6anet_num_processors: 4

  # Differential expression - DESeq2 (2x2 factorial, additive model)
  # Additive model used because anac017_1 x AA group has only 1 replicate
  deseq2_padj_threshold: 0.05
  deseq2_lfc_threshold: 1.0

# -------------------------------------------------------------
# ANALYSIS PARAMETERS
# -------------------------------------------------------------
params:
  threads: 40
  latency_wait: 60
  # m6Anet requires FAST5 data on local disk.
  # Set to true only if FAST5 data is available locally.
  run_m6anet: false
