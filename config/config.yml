# =============================================================
# K-CHOPORE Configuration File
# Pipeline for ONT Direct RNA Sequencing Analysis
# =============================================================
# Experiment: anac017 mutant vs WT, Control vs Antimycin A (AA)
# 2x2 factorial design, 3 biological replicates per group
# Organism: Arabidopsis thaliana (TAIR10 + AtRTDv2)
# Sequencing: ONT MinION, R9.4.1 flowcell, Direct RNA
# =============================================================

# -------------------------------------------------------------
# SAMPLE SHEET
# Each sample has: genotype, treatment, data_type, and source dirs
# data_type: "fastq" (pre-basecalled) or "fast5" (needs basecalling)
# fastq_dirs: NAS folder names containing fastq_pass/ subdirs
# fast5_dirs: NAS folder names containing fast5/ or fast5_pass/ subdirs
# Sample IDs use underscores only (FLAIR requirement)
# -------------------------------------------------------------
samples:
  # --- Wild Type, Control ---
  WT_C_R1:
    genotype: "WT"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["WT_C_R1"]
    run_subdirs: ["no_sample/20220224_1639_MC-112869_FAR90122_f656439d"]
  WT_C_R2:
    genotype: "WT"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["WT_C_R2"]
    run_subdirs: ["no_sample/20220323_1648_MC-112869_FAR91957_0263d5a0"]
  WT_C_R3:
    genotype: "WT"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["WT_C_R3"]
    run_subdirs: ["no_sample/20220301_1656_MC-112869_FAR90189_a35665b9"]

  # --- Wild Type, Antimycin A ---
  WT_AA_R1:
    genotype: "WT"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["WT_AA_R1"]
    run_subdirs: ["20220221_1734_MC-112869_FAR92050_00e32dc0"]
  WT_AA_R2:
    genotype: "WT"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["WT_AA_R2"]
    run_subdirs: ["no_sample/20220316_1902_MC-112869_FAR91120_624c5f7d"]
  WT_AA_R3:
    genotype: "WT"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["WT_AA_R3", "WT_AA_R3_2"]
    run_subdirs:
      - "no_sample/20220315_1614_MC-112869_FAR90098_c891954b"
      - "no_sample/20220316_1636_MC-112869_FAR90098_6e408c50"

  # --- anac017-1 mutant, Control ---
  anac017_1_C_R1:
    genotype: "anac017_1"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["anac017-1_C_R1"]
    run_subdirs: ["no_sample/20220330_1936_MC-112869_FAR92015_6ac8671e"]
  anac017_1_C_R2:
    genotype: "anac017_1"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["anac017-1_C_R2"]
    run_subdirs: ["no_sample/20220404_1440_MC-112869_FAR91811_a135af49"]
  anac017_1_C_R3:
    genotype: "anac017_1"
    treatment: "C"
    data_type: "fastq"
    nas_dirs: ["anac017-1_C_R3"]
    run_subdirs: ["no_sample/20220405_1610_MC-112869_FAR91811_d5fba51e"]

  # --- anac017-1 mutant, Antimycin A ---
  anac017_1_AA_R1:
    genotype: "anac017_1"
    treatment: "AA"
    data_type: "fastq"
    nas_dirs: ["anac017-1_AA_R1"]
    run_subdirs: ["no_sample/20220328_1730_MC-112869_FAR90074_970aa1f5"]
  anac017_1_AA_R2:
    genotype: "anac017_1"
    treatment: "AA"
    data_type: "fast5"
    nas_dirs: ["anac017-1_AA_R2", "anac017_AA_R2-2"]
    run_subdirs:
      - "no_sample/20220930_1148_MC-112869_FAR81498_9fdc7765"
      - "no_sample/20221215_1232_MC-112869_FAT21048_d754e27f"
  anac017_1_AA_R3:
    genotype: "anac017_1"
    treatment: "AA"
    data_type: "fast5"
    nas_dirs: ["anac017-1_AA_R3"]
    run_subdirs: ["no_sample/20220929_1527_MC-112869_FAU09642_5f85f08b"]

# -------------------------------------------------------------
# INPUT FILES AND DIRECTORIES
# -------------------------------------------------------------
input_files:
  # Local data directories (downloaded from NAS)
  raw_data_dir: "data/raw"

  # Reference genome and annotations
  reference_genome: "data/reference/genome/TAIR10_chr_all.fas.fasta"
  reference_genome_mmi: "data/reference/genome/TAIR10_chr_all.fas.fasta.mmi"
  gtf_file: "data/reference/annotations/AtRTDv2_QUASI_19April2016.gtf"
  transcriptome_fasta: "data/reference/transcriptome/transcriptome.fa"

# -------------------------------------------------------------
# OUTPUT SETTINGS
# -------------------------------------------------------------
output:
  path: "results"
  logs: "logs"

# -------------------------------------------------------------
# TOOL CONFIGURATIONS
# -------------------------------------------------------------
tools:
  # Basecalling - Guppy CPU (R9.4.1 flowcell, direct RNA)
  # Only used for 3 FAST5-only samples (anac017_1_AA_R2, anac017_1_AA_R3)
  basecaller: "guppy"
  guppy_config_file: "/opt/ont-guppy-cpu/data/rna_r9.4.1_70bps_hac.cfg"

  # Alignment - minimap2 (splice-aware for direct RNA)
  minimap2_preset: "splice"
  minimap2_kmer_size: 14
  minimap2_extra_flags: "--secondary=no --MD"

  # Read filtering - NanoFilt
  nanofilt_min_quality: 7
  nanofilt_min_length: 200
  nanofilt_max_length: 0

  # Quality control
  nanoplot_format: "png"
  pycoqc_min_pass_qual: 7

  # Isoform analysis - FLAIR
  flair_support: 3
  flair_stringent: true

  # RNA modification detection - ELIGOS2
  eligos2_pval: 0.05
  eligos2_oddR: 5
  eligos2_esb: 0.2

  # RNA modification detection - m6Anet
  m6anet_num_iterations: 1000
  m6anet_num_processors: 4

  # Differential expression - DESeq2 (2x2 factorial)
  deseq2_padj_threshold: 0.05
  deseq2_lfc_threshold: 1.0

# -------------------------------------------------------------
# ANALYSIS PARAMETERS
# -------------------------------------------------------------
params:
  threads: 40
  latency_wait: 60
  # m6Anet requires FAST5 data (~644 GB total, won't fit on 234 GB SSD)
  # Set to true only when FAST5 data is available on local disk
  # Alternatively, run per-sample: snakemake results/m6anet/SAMPLE_ID/data.site_proba.csv
  run_m6anet: false
